blueprint:
  name: Sync Custom Brightness
  description: >-

    [![Open your Home Assistant instance and show the blueprint import dialog with a specific blueprint pre-filled.](https://my.home-assistant.io/badges/blueprint_import.svg)](https://my.home-assistant.io/redirect/blueprint_import/?blueprint_url=https%3A%2F%2Fraw.githubusercontent.com%2Fjnrcorp%2Fha-blueprints-sync-custom-brightness%2Fmain%2Fha-blueprint-sync-custom-brightness.yaml)

    **Sync Custom Brightness v1.0** ðŸ”›

    This blueprint allows you to easily create/maintain an automation that links the state of multiple entities:
      - set the brightness of any zooz dimmer switch entity, it will set the custom brightness z-wave attribute to that brightness.

    **NOTE**: You can select any zooz dimmer switch entity with a custom brightness attribute.

    **CHANGELOG:**
      - 1.0: (2025-01-12)
        - First official release

  domain: automation
  input:
    dimmer_switch_entity:
      name: Zooz Dimmer Switch Entities
      description: Entities whose custom brightness attribute will be updated each time the brightness on the switch is updated.
      selector:
        entity:
          multiple: true
    delay_miliseconds:
      name: Delay
      description: How long to delay changes to the custom brightness attribute
      selector:
        number:
          min: 0
          max: 1000
          unit_of_measurement: miliseconds
          mode: box
      default: 200

mode: single
max_exceeded: silent

variables:
  dimmer_switch_entities: !input dimmer_switch_entity

trigger:
  - platform: state
    id: set_brightness
    entity_id: !input dimmer_switch_entity
    attribute: brightness

condition:
  - condition: template
    value_template: "{{ trigger.to_state.context.id != this.context.id }}"

action:
  - choose:
      - conditions:
          - condition: trigger
            id: set_brightness
        sequence:
          - variables:
              set_light_brightness: "{{ trigger.to_state.attributes.brightness }}"
          - service: light.turn_on
            data:
              entity_id: "{{linked_entities | accept('eq', trigger.entity_id) | list }}"
              brightness: "{{ set_light_brightness }}"
          - delay:
              milliseconds: !input delay_miliseconds
